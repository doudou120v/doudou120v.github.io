<!doctype html>
<html lang="fr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Journ√©e de travail ‚Äî Paris</title>
  <link rel="stylesheet" href="https://assets.bouyguestelecom.fr/TRILOGY/trilogy-styles@4.10.0/default/trilogy.css">
</head>

<body>
  <div class="full-page">
    <div class="card">
      <div class="card-content">
        <p class="title is-level-4">Temps restant √† ta journ√©e</p>
        <p class="title is-level-5">Meudon la For√™t, France</p>

        <p id="userInfo" class="meta" style="margin-bottom: 1rem;"></p>

        <p class="text is-level-1">Heure locale actuelle :</p>
        <p id="parisTime" class="title is-level-3" aria-live="polite">--:--:--</p>




        <div class="progress-container" role="region" aria-label="Progression de la journ√©e">
          <progress id="dayProgress" class="progress is-info" value="0" max="100" aria-valuemin="0" aria-valuemax="100"
            aria-valuenow="0">0%</progress>

          <div class="progress-legends" aria-hidden="true">
            <div class="progress-legend-start">
              <p id="legendStart" class="text">09h30</p>
            </div>
            <div class="progress-legend-end">
              <p id="legendEnd" class="text">17h00</p>
            </div>
          </div>

          <div class="remaining-time" aria-live="polite" aria-atomic="true">
            <span id="remainingLabel">Temps restant :</span>
            <span id="remainingTime">--:--:--</span>
          </div>

          <p id="percentageLabel" class="percentage-label">0% de la journ√©e de travail √©coul√©e</p>
          <p id="endMessage" class="end-message">Ta journ√©e est termin√©e.</p>
        </div>
        <div class="row">

          <div data-testid="separator" class="divider">
            <p class="divider-content"></p>
          </div>
        </div>
        <p class="text is-level-1">M√©t√©o actuelle :</p>
        <div id="weatherInfo" class="weather-box">
          <div class="icon">
            <img src="https://cdn.weatherapi.com/weather/64x64/day/116.png" alt="Partiellement ensoleill√©" />
          </div>
          <div class="condition">Partiellement ensoleill√©</div>
          <div class="rows">
            <div class="row">
              <p class="title is-level-6">voici les infos m√©t√©orologique</p>
              <div class="columns is-fullwidth">
                <div class="column">
                  <div class="box is-flat">
                    <div>Temp√©rature :</div>
                    <div>16‚ÄØ¬∞C</div>
                  </div>
                </div>
                <div class="column">
                  <div class="box is-flat">
                    <div>Ressenti :</div>
                    <div>15‚ÄØ¬∞C</div>
                  </div>
                </div>
              </div>
              <div class="row">

                <div class="columns is-fullwidth">
                  <div class="column">
                    <div class="box is-flat">
                      <div>Humidit√© :</div>
                      <div>63‚ÄØ%</div>
                    </div>
                  </div>
                  <div class="column">
                    <div class="box is-flat">
                      <div>Vent :</div>
                      <div>18‚ÄØkm/h (NNE)</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="segmented-control" style="margin: 20px 1 ; text-align: center;">
              <a href="index.html" class="segmented-control-item">acceuil</a>
              <a href="page3.html" class="segmented-control-item">patate</a>
            </div>
            
          </div>
        </div>
      </div>

      <script>

        function showUserInfo() {
          const params = new URLSearchParams(window.location.search);
          const name = params.get('name');
          const intent = params.get('intent');
          const infoEl = document.getElementById('userInfo');
          if (name && intent && infoEl) {
            infoEl.textContent = `üë§ Bonjour ${name} ‚Äî objectif : ${intent}`;
          }
        }
        showUserInfo();

        (function () {
          'use strict';

          const WORK_START = "09:30";
          const WORK_END = "17:00";
          const WEATHER_API_KEY = '93d10ec96a364ca89b2143951251410';
          const CITY_NAME = 'Meudon';
          const WEATHER_URL = `https://api.weatherapi.com/v1/current.json?key=${WEATHER_API_KEY}&q=${encodeURIComponent(CITY_NAME)}&lang=fr`;

          const parisTimeEl = document.getElementById('parisTime');
          const remainingTimeEl = document.getElementById('remainingTime');
          const remainingLabelEl = document.getElementById('remainingLabel');
          const dayProgress = document.getElementById('dayProgress');
          const percentageLabel = document.getElementById('percentageLabel');
          const endMessage = document.getElementById('endMessage');
          const legendStart = document.getElementById('legendStart');
          const legendEnd = document.getElementById('legendEnd');
          const weatherInfoEl = document.getElementById('weatherInfo');

          const pad2 = n => String(n).padStart(2, '0');

          function parseHM(hm) {
            const parts = hm.split(':').map(Number);
            if (parts.length !== 2 || parts.some(isNaN)) return null;
            const [hour, minute] = parts;
            return { hour, minute };
          }

          function msToHMS(ms) {
            if (ms <= 0) return '00:00:00';
            const totalSeconds = Math.floor(ms / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            return `${pad2(hours)}:${pad2(minutes)}:${pad2(seconds)}`;
          }

          function initLegends() {
            const s = parseHM(WORK_START);
            const e = parseHM(WORK_END);
            legendStart.textContent = s ? `${pad2(s.hour)}h${pad2(s.minute)}` : '--:--';
            legendEnd.textContent = e ? `${pad2(e.hour)}h${pad2(e.minute)}` : '--:--';
          }

          function getParisNow() {
            return new Date(new Date().toLocaleString('en-US', { timeZone: 'Europe/Paris' }));
          }

          function updateAll(now) {
            const timeText = now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
            parisTimeEl.textContent = timeText;

            const start = parseHM(WORK_START);
            const end = parseHM(WORK_END);
            if (!start || !end) return;

            const startDate = new Date(now);
            startDate.setHours(start.hour, start.minute, 0, 0);
            const endDate = new Date(now);
            endDate.setHours(end.hour, end.minute, 0, 0);
            if (endDate <= startDate) endDate.setDate(endDate.getDate() + 1);

            if (now < startDate) {
              const diff = startDate - now;
              remainingTimeEl.textContent = msToHMS(diff);
              remainingLabelEl.textContent = 'Temps avant le d√©but :';
              dayProgress.value = 0;
              dayProgress.setAttribute('aria-valuenow', '0');
              percentageLabel.textContent = 'La journ√©e n‚Äôa pas encore commenc√©.';
              endMessage.style.display = 'none';
            } else if (now >= endDate) {
              remainingTimeEl.textContent = '00:00:00';
              remainingLabelEl.textContent = 'Temps restant :';
              dayProgress.value = 100;
              dayProgress.setAttribute('aria-valuenow', '100');
              percentageLabel.textContent = '100% de la journ√©e de travail √©coul√©e';
              endMessage.style.display = '';
            } else {
              const diff = endDate - now;
              const total = endDate - startDate;
              const elapsed = now - startDate;
              const pct = Math.max(0, Math.min(100, Number(((elapsed / total) * 100).toFixed(1))));
              remainingTimeEl.textContent = msToHMS(diff);
              remainingLabelEl.textContent = 'Temps restant :';
              dayProgress.value = pct;
              dayProgress.setAttribute('aria-valuenow', String(pct));
              percentageLabel.textContent = `${pct}% de la journ√©e de travail √©coul√©e`;
              endMessage.style.display = 'none';
            }
          }

          function updateWeather() {
            fetch(WEATHER_URL)
              .then(response => response.json())
              .then(data => {
                if (!data || !data.current || !data.location)
                  weatherInfoEl.innerHTML = `
              <div class="icon"><img src="https:${icon}" alt="${description}" /></div>
              <div class="condition">${description}</div>
              <div class="details">
                <div>Temp√©rature :</div><div>${temp}‚ÄØ¬∞C</div>
                <div>Ressenti :</div><div>${feelsLike}‚ÄØ¬∞C</div>
                <div>Humidit√© :</div><div>${humidity}‚ÄØ%</div>
                <div>Vent :</div><div>${windSpeed}‚ÄØkm/h (${windDir})</div>
              </div>
            `;
              })
              .catch(err => {
                weatherInfoEl.innerHTML = `<p>‚ùå Impossible de charger la m√©t√©o.</p>`;
                console.error('Erreur m√©t√©o :', err);
              });
          }

          let intervalId = null;

          function tickOnce() {
            updateAll(getParisNow());
          }

          function startTicker() {
            tickOnce();
            const now = Date.now();
            const timeout = 1000 - (now % 1000);
            setTimeout(() => {
              tickOnce();
              intervalId = setInterval(tickOnce, 1000);
            }, timeout);
          }

          function stopTicker() {
            if (intervalId !== null) {
              clearInterval(intervalId);
              intervalId = null;
            }
          }

          document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
              stopTicker();
            } else {
              startTicker();
            }
          }, { passive: true });

          initLegends();
          startTicker();
          updateWeather();

          window.__WORK_CONFIG = { WORK_START, WORK_END };
          window.__forceUpdateWorkClock = () => updateAll(getParisNow());
        })();
      </script>
</body>

</html>