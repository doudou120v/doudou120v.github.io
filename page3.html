<!doctype html>
<html lang="fr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Journée de travail - Meudon </title>
  <link rel="stylesheet" href="https://assets.bouyguestelecom.fr/TRILOGY/trilogy-styles@4.10.0/default/trilogy.css">
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .full-page {
      width: 100%;
      max-width: 800px;
      padding: 20px;
      box-sizing: border-box;
      margin: auto;
    }

    .card {
      width: 100%;
    }

    .card-content p {
      margin: .35rem 0;
    }

    #parisTime {
      font-weight: 700;
      font-variant-numeric: tabular-nums;
    }

    .progress-container {
      margin-top: 20px;
    }

    .progress-legends {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
    }

    .percentage-label {
      text-align: center;
      font-weight: bold;
      margin-top: 10px;
    }

    .end-message {
      text-align: center;
      font-weight: bold;
      color: #e74c3c;
      margin-top: 15px;
      display: none;
    }

    #timeImage {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin-top: 20px;
      display: block;
    }

    .manual-time {
      margin-top: 30px;
      text-align: center;
    }

    .manual-time input {
      max-width: 200px;
    }

    .manual-time .button {
      margin-top: 10px;
    }

    @media screen and (max-width: 768px) {
      .progress-legends {
        flex-direction: column;
        align-items: center;
        gap: .5rem;
      }

      .progress-legends>div {
        text-align: center;
      }
    }

    .sr-only {
      position: absolute;
      left: -10000px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div class="full-page">
    <header role="banner" aria-label="En-tête">
      <h1 class="title is-level-4">Temps restant à ta journée</h1>
      <p class="title is-level-5">Meudon la Forêt, France</p>
    </header>
    <div class="columns is-multiline">
      <div class="column">
        <section class="hero is-base is-overlapped has-pattern-dark">
          <div class="hero-body">
            <div class="container">
              <h1 class="title is-level-2 is-inverted">Internet garanti</h1>
              <p class="text is-inverted is-inverted has-text-weight-bold">Profitez dInternet dès labonnement et même en
                cas
                de coupure grâce à une clé 4G dans les nouvelles offres Bbox.</p>
            </div>
          </div>
        </section>
        <section class="section">
          <div class="container">
            <div class="box">
              <div class="box-content">
                <p class="title is-level-2">Internet garanti</p>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
    <main role="main" aria-labelledby="statusTitle">
      <section class="card" id="statusCard">
        <div class="card-content">
          <h2 id="statusTitle" class="sr-only">Statut horaire</h2>

          <p class="text is-level-1">Heure locale actuelle :</p>
          <p id="parisTime" class="title is-level-3" aria-live="polite" aria-atomic="true">--:--:--</p>

          <div class="progress-container" role="region" aria-label="Progression de la journée de travail">
            <progress id="dayProgress" class="progress is-info" value="0" max="100" aria-valuemin="0"
              aria-valuemax="100" aria-valuenow="0"></progress>

            <div class="progress-legends" aria-hidden="true">
              <div class="progress-legend-start">
                <p id="legendStart" class="text">--:--</p>
              </div>
              <div class="progress-legend-end">
                <p id="legendEnd" class="text">--:--</p>
              </div>
            </div>

            <p id="percentageLabel" class="percentage-label">0% de la journée de travail écoulée</p>
            <p id="endMessage" class="end-message" role="status">Ta journée est terminée.</p>
          </div>

          <div class="progress-container" aria-hidden="false">
            <p class="title is-level-4" style="margin-top:20px;">Image du moment</p>
            <img id="timeImage" src="" alt="Visuel horaire" loading="lazy" />
          </div>

          <div>
            <button id="applyTimeBtn" class="button is-primary"></button>

          <div class="field" style="margin-top: 30px; text-align: center;">
            <div class="control">
              <a href="index.html" class="button is-secondary">← Retour à la page de choix</a>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>


    (function () {
      'use strict';
      const WORK_START = "09:30";
      const WORK_END = "17:00";
      const parisTimeEl = document.getElementById('parisTime');
      const dayProgress = document.getElementById('dayProgress');
      const percentageLabel = document.getElementById('percentageLabel');
      const endMessage = document.getElementById('endMessage');
      const legendStart = document.getElementById('legendStart');
      const legendEnd = document.getElementById('legendEnd');
      const timeImage = document.getElementById('timeImage');
      const manualTimeInput = document.getElementById('manualTime');
      const applyTimeBtn = document.getElementById('applyTimeBtn');
      const resetTimeBtn = document.getElementById('resetTimeBtn');

      let manualTime = null;

      applyTimeBtn.addEventListener('click', () => {
        const input = manualTimeInput.value;
        if (input) {
          const [h, m] = input.split(':').map(Number);
          if (!isNaN(h) && !isNaN(m)) {
            const now = getParisNow();
            now.setHours(h, m, 0, 0);
            manualTime = now;
            tick();
          }
        }
      });

      function parseHM(hm) {
        const parts = hm.split(':').map(Number);
        if (parts.length !== 2 || parts.some(isNaN)) return null;
        return { hour: parts[0], minute: parts[1] };
      }

      function formatLabelHM(hm, sep = 'h') {
        const p = parseHM(hm);
        return p ? `${String(p.hour).padStart(2, '0')}${sep}${String(p.minute).padStart(2, '0')}` : '--:--';
      }

      function getParisNow() {
        return new Date(new Date().toLocaleString('en-US', { timeZone: 'Europe/Paris' }));
      }

      legendStart.textContent = formatLabelHM(WORK_START);
      legendEnd.textContent = formatLabelHM(WORK_END);

      function updateDayProgress(now) {
        const startHM = parseHM(WORK_START);
        const endHM = parseHM(WORK_END);
        if (!startHM || !endHM) return;

        const start = new Date(now);
        start.setHours(startHM.hour, startHM.minute, 0, 0);
        const end = new Date(now);
        end.setHours(endHM.hour, endHM.minute, 0, 0);
        if (end <= start) end.setDate(end.getDate() + 1);

        if (now < start) {
          dayProgress.value = 0;
          dayProgress.setAttribute('aria-valuenow', '0');
          percentageLabel.textContent = 'La journée n’a pas encore commencé.';
          endMessage.style.display = 'none';
        } else if (now >= end) {
          dayProgress.value = 100;
          dayProgress.setAttribute('aria-valuenow', '100');
          percentageLabel.textContent = '100% de la journée de travail écoulée';
          endMessage.style.display = 'block';
        } else {
          const total = end - start;
          const elapsed = now - start;
          const pct = Math.max(0, Math.min(100, Number(((elapsed / total) * 100).toFixed(1))));
          dayProgress.value = pct;
          dayProgress.setAttribute('aria-valuenow', String(pct));
       
                    percentageLabel.textContent = `${pct}% de la journée `;
          endMessage.style.display = 'none';
        }
      }

      function updateTimeImage(now) {
        const hour = now.getHours();
        const minute = now.getMinutes();
        const timeInMinutes = hour * 60 + minute;

        const images = [
          { from: 540, to: 690, src: "https://www.bing.com/th/id/OIP.SfmtoITTswDirJEeBm6XagHaHa?w=189&h=211&c=8&rs=1&qlt=90&o=6&dpr=1.5&pid=3.1&rm=2", alt: "Matin tôt" },
          { from: 690, to: 735, src: "https://th.bing.com/th/id/OIP.b8hMSsdwY_vxMfa1FyLzbQHaHa?w=168&h=180&c=7&r=0&o=7&dpr=1.5&pid=1.7&rm=3", alt: "Matin" },
          { from: 735, to: 810, src: "https://www.bing.com/th/id/OIP.OuxuKGlCziS6LEanbVq8aAHaEV?w=247&h=211&c=8&rs=1&qlt=90&o=6&dpr=1.5&pid=3.1&rm=2", alt: "Fin de matinée" },
          { from: 810, to: 960, src: "https://www.bing.com/th/id/OIP.w9CDBehHrRAYmciz3SGYTgHaE8?w=254&h=211&c=8&rs=1&qlt=90&o=6&dpr=1.5&pid=3.1&rm=2", alt: "Après-midi" },
          { from: 960, to: 990, src: "https://www.bing.com/th/id/OIP.731dy08emdOSmne0XQVqzQHaHa?w=171&h=211&c=8&rs=1&qlt=90&o=6&dpr=1.5&pid=3.1&rm=2", alt: "Fin d'après-midi" },
          { from: 990, to: 1080, src: "https://www.bing.com/th/id/OIP.w9CDBehHrRAYmciz3SGYTgHaE8?w=254&h=211&c=8&rs=1&qlt=90&o=6&dpr=1.5&pid=3.1&rm=2", alt: "Soirée précoce" }
        ];

        const defaultImg = {
          src: "https://www.bing.com/th/id/OIP.eUtHVgtGROvWrx20ysxOIAHaEK?w=248&h=211&c=8&rs=1&qlt=90&o=6&dpr=1.5&pid=3.1&rm=2",
          alt: "Nuit"
        };

        const found = images.find(i => timeInMinutes >= i.from && timeInMinutes < i.to) || defaultImg;

        if (timeImage.getAttribute('src') !== found.src) {
          timeImage.src = found.src;
          timeImage.alt = found.alt;
        }
      }

      timeImage.addEventListener('error', function () {
        timeImage.style.display = 'none';
      });

      function tick() {
        const now = manualTime || getParisNow();
        parisTimeEl.textContent = now.toLocaleTimeString('fr-FR', {
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          hour12: false
        });
        updateDayProgress(now);
        updateTimeImage(now);
      }

      tick();
      const timer = setInterval(tick, 1000);

      window.__WORK_CONFIG = { WORK_START, WORK_END };
    })();
  </script>
</body>

</html>
